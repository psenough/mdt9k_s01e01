(function(){function p(m,p,e,n){function q(a){if(window.Module&&Module._openmpt_module_create_from_memory)a();else if(e.pathToLibOpenMPT){var c=document.getElementsByTagName("head")[0],b=document.createElement("script");b.src=e.pathToLibOpenMPT;var d=!1;b.onload=b.onreadystatechange=function(){if(!d&&(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState))d=!0,a(),c.removeChild(b)};c.appendChild(b)}else throw"libopenmpt.js not imported and pathToLibOpenMPT not specified";}var f,
g,h,r=this;e||(e={});n||(n={});this.cleanup=function(){f&&Module._openmpt_module_destroy(f);g&&Module._free(g);h&&Module._free(h)};this.load=function(a){q(function(){this.channelCount=2;var c=new XMLHttpRequest;c.addEventListener("error",function(a){console.log("XHR error",a)});c.addEventListener("load",function(b){data=c.response;b=new Int8Array(data);var d=Module._malloc(b.byteLength);Module.HEAPU8.set(b,d);f=Module._openmpt_module_create_from_memory(d,b.byteLength,0,0,0);g=Module._malloc(16384);
h=Module._malloc(16384);r.duration=Module._openmpt_module_get_duration_seconds(f);a()});c.open("GET",m,!0);c.responseType="arraybuffer";c.send()})};this.generateAudio=function(a){var c=a.getChannelData(0),b=a.getChannelData(1);a=a.length;for(var d=0;0<a;){for(var e=Math.min(a,4096),k=Module._openmpt_module_read_float_stereo(f,p.sampleRate,e,g,h),m=Module.HEAPF32.subarray(g/4,g/4+k),n=Module.HEAPF32.subarray(h/4,h/4+k),l=0;l<k;++l)c[d+l]=m[l],b[d+l]=n[l];a-=k;d+=k;if(k<e)break}return d};this.seek=
function(a){Module._openmpt_module_set_position_seconds(f,a)}}Cowbell.Player.OpenMPT=function(m){return new Cowbell.Common.WebAudioPlayer(p,m)}})();
